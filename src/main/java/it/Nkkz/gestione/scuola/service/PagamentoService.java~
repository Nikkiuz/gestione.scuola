package it.Nkkz.gestione.scuola.service;

import it.Nkkz.gestione.scuola.dto.PagamentoMensileDTO;
import it.Nkkz.gestione.scuola.entity.Pagamento;
import it.Nkkz.gestione.scuola.repository.PagamentoRepository;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class PagamentoService {

	private final PagamentoRepository pagamentoRepository;

	public PagamentoService(PagamentoRepository pagamentoRepository) {
		this.pagamentoRepository = pagamentoRepository;
	}

	// ✅ Recupera il totale dei pagamenti suddivisi per mese (per la Dashboard)
	public PagamentoMensileDTO getPagamentiMensili() {
		List<Object[]> results = pagamentoRepository.getPagamentiMensili();

		List<String> mesi = results.stream()
			.map(result -> (String) result[0])
			.toList();

		List<Double> importi = results.stream()
			.map(result -> (Double) result[1])
			.toList();

		return new PagamentoMensileDTO(mesi, importi);
	}

	// ✅ Recupera il totale complessivo dei pagamenti effettuati
	public double getTotalePagamenti() {
		return pagamentoRepository.getTotalePagamenti();
	}
}
